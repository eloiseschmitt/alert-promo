<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Check Promotions ‚Äì Report</title>
    <style>
      :root { --bg:#0b1020; --card:#11162a; --muted:#8ea1b2; --text:#e9eef5; --accent:#2dd4bf; --warn:#f59e0b; --danger:#ef4444; --ok:#22c55e; }
      html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: system-ui,-apple-system,Segoe UI,Roboto,Cantarell,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji"; }
      .container { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
      .card { background: var(--card); border: 1px solid rgba(255,255,255,.06); border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,.2); }
      h1 { font-size: 22px; margin: 0 0 4px; }
      p.muted { color: var(--muted); margin: 0 0 16px; }
      .badge { display:inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; font-weight: 700; }
      .badge.ok { background: rgba(34,197,94,.15); color: var(--ok); }
      .badge.none { background: rgba(239,68,68,.12); color: var(--danger); }
      .badge.http { background: rgba(245,158,11,.12); color: var(--warn); }
      .table-wrap { overflow:auto; border-radius: 12px; border: 1px solid rgba(255,255,255,.06); }
      table { width:100%; border-collapse: collapse; }
      th, td { padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,.06); text-align: left; font-size: 14px; }
      th { background: rgba(255,255,255,.03); }
      .mono { font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; font-size: 12px; }
      .category-row td { font-weight: 700; text-transform: uppercase; letter-spacing: .06em; background: rgba(255,255,255,.05); }
      .footer { color: var(--muted); font-size: 12px; margin-top: 10px; }
      a { color: var(--accent); text-decoration: none; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>üîç Check Promotions ‚Äì Rapport quotidien</h1>
        <p class="muted">G√©n√©r√© le {{ generated_at }} (heure UTC). Timeout {{ default_timeout }}s ‚Ä¢ Retries: 3</p>

        <div class="table-wrap">
          <table role="grid" aria-label="Results">
            <thead>
              <tr>
                <th>#</th>
                <th>URL</th>
                <th>Status</th>
                <th>Promo?</th>
                <th>Found</th>
                <th>Error</th>
                <th>Changed</th>
              </tr>
            </thead>
            <tbody>
              {% set current_category = None %}
              {% for row in results %}
              {% set previous_category = current_category %}
              {% set current_category = row.category %}
              {% if current_category and current_category != previous_category %}
              <tr class="category-row">
                <td class="mono" colspan="7">{{ current_category }}</td>
              </tr>
              {% endif %}
              <tr>
                <td class="mono">{{ loop.index }}</td>
                <td class="mono">{{ row.url }}</td>
                <td>
                  {% if row.status == 'ok' %}
                    <span class="badge ok">OK</span>
                  {% elif row.status and row.status.startswith('http_') %}
                    <span class="badge http">{{ row.status }}</span>
                  {% else %}
                    <span class="badge none">{{ row.status or '‚Äî' }}</span>
                  {% endif %}
                </td>
                <td>
                  {% if row.has_promo %}
                    <span class="badge ok">PROMO</span>
                  {% else %}
                    <span class="badge none">‚Äî</span>
                  {% endif %}
                </td>
                <td>{{ row.found|join(', ') }}</td>
                <td class="mono">{{ row.error or '' }}</td>
                <td>
                  {% if row.changed %}
                    <span class="badge http">CHANGED</span>
                  {% else %}
                    <span class="badge ok">Stable</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="footer">Source: <span class="mono">websites.txt</span> ‚Ä¢ {{ results|length }} URLs v√©rifi√©es.</div>
      </div>
    </div>
  </body>
</html>
